generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model DentalLead {
  id          String   @id @default(cuid())
  source      String   @default("contact_sales")
  phone       String?
  email       String?
  pagePath    String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  notes       String?
  createdAt   DateTime @default(now())

  @@map("DentalLead")
}

// Demo-only models (tables used only for the DentalScan demo flow)

model DemoDentist {
  id        String        @id @default(cuid())
  name      String
  email     String?
  phone     String?
  createdAt DateTime      @default(now())

  patients  DemoPatient[]
  scans     DemoScan[]

  @@map("demo_dentist")
}

model DemoPatient {
  id        String      @id @default(cuid())
  name      String
  phone     String
  email     String?
  createdAt DateTime    @default(now())

  dentist   DemoDentist @relation(fields: [dentistId], references: [id])
  dentistId String

  scans     DemoScan[]

  @@map("demo_patient")
}

model DemoScan {
  id          String        @id @default(cuid())
  status      String        @default("link_sent") // link_sent | submitted | completed
  imageUrls   Json?
  result      Json?
  createdAt   DateTime      @default(now())
  submittedAt DateTime?
  completedAt DateTime?

  dentist     DemoDentist?  @relation(fields: [dentistId], references: [id])
  dentistId   String?

  patient     DemoPatient?  @relation(fields: [patientId], references: [id])
  patientId   String?

  // NEW: short links associated with this scan
  links       DemoScanLink[]

  @@map("demo_scan")
}

model DemoScanLink {
  id        String      @id @default(cuid())
  code      String      @unique        // e.g. "AB3F9X2K"
  scan      DemoScan    @relation(fields: [scanId], references: [id])
  scanId    String

  dentistId String?
  patientId String?

  createdAt DateTime    @default(now())
  expiresAt DateTime?

  @@map("demo_scan_link")
}

model PartnerWithUs {
  id           String   @id @default(cuid())
  name         String
  email        String
  organization String?
  type         String
  message      String?
  createdAt    DateTime @default(now())

  @@map("PartnerWithUs")
}

model partner_application {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  program       String   @db.VarChar(50) // charity | gym | employer | school ...
  status        String?  @default("new") @db.VarChar(50)

  name          String?  @db.VarChar(255) // primary contact name
  email         String?  @db.VarChar(255)
  phone         String?  @db.VarChar(50)

  organization  String?  @db.VarChar(255)
  street_address String? @db.VarChar(255)
  city          String?  @db.VarChar(100)
  state         String?  @db.VarChar(50)
  zip_code      String?  @db.VarChar(20)
  country       String?  @default("USA") @db.VarChar(100)

  notes         String?  @default("")
  decision_path String?  @default("") @db.VarChar(50)

  payload       Json?    // ✅ store full original form safely (program-specific fields)

  submitted_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @updatedAt

  @@index([program], map: "idx_partner_application_program")
  @@index([status], map: "idx_partner_application_status")
  @@index([submitted_at(sort: Desc)], map: "idx_partner_application_submitted_at")
}

model partner_clinic {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clinic_name  String

  // ✅ structured address (for routing + clean UI)
  street_address String
  city           String
  state          String
  zip_code       String
  country        String   @default("US")

  // ✅ keep a friendly display string (optional but useful)
  address_line String

  phone_number String
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  charity_programs  charity_program[]
  program_links charity_program_partner[]
  network_coverages network_clinic_coverage[]
}